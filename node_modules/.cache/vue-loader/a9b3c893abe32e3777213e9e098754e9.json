{"remainingRequest":"C:\\Users\\windows\\Desktop\\前端开发\\VUE\\supermall-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\windows\\Desktop\\前端开发\\VUE\\supermall-master\\src\\views\\detail\\Detail.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\windows\\Desktop\\前端开发\\VUE\\supermall-master\\src\\views\\detail\\Detail.vue","mtime":1599903017000},{"path":"C:\\Users\\windows\\Desktop\\前端开发\\VUE\\supermall-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1619665387549},{"path":"C:\\Users\\windows\\Desktop\\前端开发\\VUE\\supermall-master\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\windows\\Desktop\\前端开发\\VUE\\supermall-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1619665387549},{"path":"C:\\Users\\windows\\Desktop\\前端开发\\VUE\\supermall-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport DetailNavBar from \"@/views/detail/childComps/DetailNavBar\";\nimport {getDetail, Goods, Shop, GoodsParam,getRecommend} from \"@/network/detail\";\nimport DetailSwiper from \"@/views/detail/childComps/DetailSwiper\";\nimport DetailBaseInfo from \"@/views/detail/childComps/DetailBaseInfo\";\nimport DetailShopInfo1 from \"@/views/detail/childComps/DetailShopInfo1\";\nimport Scroll from \"@/components/common/scroll/Scroll\";\nimport DetailGoodsInfo from \"@/views/detail/childComps/DetailGoodsInfo\";\nimport DetailParamInfo from \"@/views/detail/childComps/DetailParamInfo\";\nimport DetailComment from \"@/views/detail/childComps/DetailComment\";\nimport DetailBottomBar from \"@/views/detail/childComps/DetailBottomBar\";\nimport Toast from \"@/components/common/toast/Toast\";\n\nimport GoodsListItem from \"@/components/content/goods/GoodsListItem\";\nimport GoodsList from \"@/components/content/goods/GoodsList\";\nimport {debounce} from \"@/common/utils\";\nimport {backTopMixin} from \"@/common/mixin\";\n\n\nexport default {\n  name: \"Detail\",\n  components: {\n    DetailNavBar,\n    DetailSwiper,\n    DetailBaseInfo,\n    DetailShopInfo1,\n    Scroll,\n    Toast,\n    DetailGoodsInfo,\n    DetailParamInfo,\n    DetailComment,\n    GoodsListItem,\n    GoodsList,\n    DetailBottomBar,\n  },\n  mixins: [backTopMixin],\n  data() {\n    return {\n      iid: null,\n      topimages: [],\n      goods: {},\n      shop: {},\n      detailinfo: {},\n      paramInfo: {},\n      commentInfo: {},\n      recommends: [],\n      titleTopY: [],\n      getThemeTopy: null,\n      currentIndex: 0,\n      show: false,\n      message: ''\n    }\n  },\n  created() {\n    this.iid = this.$route.params.iid\n    getDetail(this.iid).then((res) => {\n      //1.获取顶部轮播数据\n      console.log(res)\n      const data = res.result\n      this.topimages = data.itemInfo.topImages\n      //2.获取商品信息\n      this.goods = new Goods(data.itemInfo, data.columns, data.shopInfo.services)\n      //3.获取店铺信息\n      this.shop = new Shop(data.shopInfo)\n      //4.保存商品的详情数据\n      this.detailinfo = data.detailInfo\n      //5.获取参数信息\n      this.paramInfo = new GoodsParam(data.itemParams.info, data.itemParams.rule)\n      //6.获取评论信息\n\n        this.commentInfo = data.rate.list[0]\n\n      //7.获取推荐信息\n\n    })\n    getRecommend().then((res)=> {\n      this.recommends = res.data.list\n    })\n    this.getThemeTopy = debounce(()=>{\n      this.$nextTick(() => {\n        //获取不同组件的offsetTop\n        this.titleTopY = [];\n        this.titleTopY.push(0);\n        this.titleTopY.push(this.$refs.params.$el.offsetTop );\n        this.titleTopY.push(this.$refs.comment.$el.offsetTop );\n        this.titleTopY.push(this.$refs.recommends.$el.offsetTop );\n        this.titleTopY.push(Number.MAX_VALUE);\n        console.log(this.titleTopY);\n      });\n    },100)\n  },\n  updated() {\n  },\n  mounted() {\n    let newRefresh = debounce(this.$refs.scroll.refresh,100)\n   this.$bus.$on('detailImageLoad',()=>{\n     newRefresh()\n   })\n\n  },\n  methods: {\n    imageload() {\n      this.$refs.scroll.refresh()\n      //图片加载获取offsettop\n      this.getThemeTopy()\n    },\n    //点击导航栏跳转页面\n    titleClick(index) {\n      this.$refs.scroll.scrollTo(0, -this.titleTopY[index], 100)\n    },\n    //滚动详情页与顶部导航栏的对应\n    contentScroll(position) {\n      const positionY = -position.y\n      let length = this.titleTopY.length\n      // for (let i in this.titleTopY){\n      //   if (positionY > this.titleTopY[i] && positionY < this.titleTopY[i+1]){\n      //     console.log(i)\n      //   }\n      // }\n      for (let i = 0; i < this.titleTopY.length - 1; i++) {\n        if (this.currentIndex !== i && ((positionY >= this.titleTopY[i] && positionY < this.titleTopY[i + 1]))) {\n          this.currentIndex = i\n          console.log(this.currentIndex)\n          this.$refs.nav.currentIndex = this.currentIndex\n        }\n      }\n      //抽取混入\n      this.listenShowBackTop(position)\n    },\n    //加入购物车\n    addToCart(){\n      //获取数据\n     const product = {}\n     product.image = this.topimages[0];\n     product.title = this.goods.title;\n     product.desc = this.goods.desc;\n     product.price = this.goods.oldPrice;\n     product.iid = this.iid;\n     //添加到购物车\n   // this.$store.commit('addCart',product)\n      this.$store.dispatch('addCart',product).then((res)=>{\n      this.show = true;\n      this.message = res;\n      setTimeout(()=>{\n        this.show = false\n        this.message=''\n      },1500)\n\n        // console.log(this.$toast)\n        // this.$toast.Show()\n      })\n\n    }\n  }\n\n}\n",{"version":3,"sources":["Detail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA","file":"Detail.vue","sourceRoot":"src\\views\\detail","sourcesContent":["<template>\n  <div id=\"detail\">\n    <detail-nav-bar class=\"detail-nav\" @titleClick=\"titleClick\"ref=\"nav\">\n    </detail-nav-bar>\n    <scroll class=\"content\" ref=\"scroll\"@scroll=\"contentScroll\" :probe-type=\"3\">\n      <div>\n      <detail-swiper :topimages=\"topimages\"></detail-swiper>\n      <detail-base-info :goods=\"goods\"></detail-base-info>\n      <detail-shop-info1 :shop=\"shop\"></detail-shop-info1>\n      <detail-goods-info :detail-info=\"detailinfo\" @imageload=\"imageload\"></detail-goods-info>\n      <detail-param-info :param-info=\"paramInfo\"ref=\"params\"></detail-param-info>\n      <detail-comment :comment-info=\"commentInfo\"ref=\"comment\"></detail-comment>\n      <goods-list :goods=\"recommends\"ref=\"recommends\"></goods-list>\n      </div>\n    </scroll>\n    <back-top @click.native=\"backClick\" v-show=\"isShow\"></back-top>\n    <detail-bottom-bar @addCart=\"addToCart\"></detail-bottom-bar>\n    <toast :isshow=\"show\" :ismessage=\"message\"/>\n  </div>\n</template>\n\n<script>\nimport DetailNavBar from \"@/views/detail/childComps/DetailNavBar\";\nimport {getDetail, Goods, Shop, GoodsParam,getRecommend} from \"@/network/detail\";\nimport DetailSwiper from \"@/views/detail/childComps/DetailSwiper\";\nimport DetailBaseInfo from \"@/views/detail/childComps/DetailBaseInfo\";\nimport DetailShopInfo1 from \"@/views/detail/childComps/DetailShopInfo1\";\nimport Scroll from \"@/components/common/scroll/Scroll\";\nimport DetailGoodsInfo from \"@/views/detail/childComps/DetailGoodsInfo\";\nimport DetailParamInfo from \"@/views/detail/childComps/DetailParamInfo\";\nimport DetailComment from \"@/views/detail/childComps/DetailComment\";\nimport DetailBottomBar from \"@/views/detail/childComps/DetailBottomBar\";\nimport Toast from \"@/components/common/toast/Toast\";\n\nimport GoodsListItem from \"@/components/content/goods/GoodsListItem\";\nimport GoodsList from \"@/components/content/goods/GoodsList\";\nimport {debounce} from \"@/common/utils\";\nimport {backTopMixin} from \"@/common/mixin\";\n\n\nexport default {\n  name: \"Detail\",\n  components: {\n    DetailNavBar,\n    DetailSwiper,\n    DetailBaseInfo,\n    DetailShopInfo1,\n    Scroll,\n    Toast,\n    DetailGoodsInfo,\n    DetailParamInfo,\n    DetailComment,\n    GoodsListItem,\n    GoodsList,\n    DetailBottomBar,\n  },\n  mixins: [backTopMixin],\n  data() {\n    return {\n      iid: null,\n      topimages: [],\n      goods: {},\n      shop: {},\n      detailinfo: {},\n      paramInfo: {},\n      commentInfo: {},\n      recommends: [],\n      titleTopY: [],\n      getThemeTopy: null,\n      currentIndex: 0,\n      show: false,\n      message: ''\n    }\n  },\n  created() {\n    this.iid = this.$route.params.iid\n    getDetail(this.iid).then((res) => {\n      //1.获取顶部轮播数据\n      console.log(res)\n      const data = res.result\n      this.topimages = data.itemInfo.topImages\n      //2.获取商品信息\n      this.goods = new Goods(data.itemInfo, data.columns, data.shopInfo.services)\n      //3.获取店铺信息\n      this.shop = new Shop(data.shopInfo)\n      //4.保存商品的详情数据\n      this.detailinfo = data.detailInfo\n      //5.获取参数信息\n      this.paramInfo = new GoodsParam(data.itemParams.info, data.itemParams.rule)\n      //6.获取评论信息\n\n        this.commentInfo = data.rate.list[0]\n\n      //7.获取推荐信息\n\n    })\n    getRecommend().then((res)=> {\n      this.recommends = res.data.list\n    })\n    this.getThemeTopy = debounce(()=>{\n      this.$nextTick(() => {\n        //获取不同组件的offsetTop\n        this.titleTopY = [];\n        this.titleTopY.push(0);\n        this.titleTopY.push(this.$refs.params.$el.offsetTop );\n        this.titleTopY.push(this.$refs.comment.$el.offsetTop );\n        this.titleTopY.push(this.$refs.recommends.$el.offsetTop );\n        this.titleTopY.push(Number.MAX_VALUE);\n        console.log(this.titleTopY);\n      });\n    },100)\n  },\n  updated() {\n  },\n  mounted() {\n    let newRefresh = debounce(this.$refs.scroll.refresh,100)\n   this.$bus.$on('detailImageLoad',()=>{\n     newRefresh()\n   })\n\n  },\n  methods: {\n    imageload() {\n      this.$refs.scroll.refresh()\n      //图片加载获取offsettop\n      this.getThemeTopy()\n    },\n    //点击导航栏跳转页面\n    titleClick(index) {\n      this.$refs.scroll.scrollTo(0, -this.titleTopY[index], 100)\n    },\n    //滚动详情页与顶部导航栏的对应\n    contentScroll(position) {\n      const positionY = -position.y\n      let length = this.titleTopY.length\n      // for (let i in this.titleTopY){\n      //   if (positionY > this.titleTopY[i] && positionY < this.titleTopY[i+1]){\n      //     console.log(i)\n      //   }\n      // }\n      for (let i = 0; i < this.titleTopY.length - 1; i++) {\n        if (this.currentIndex !== i && ((positionY >= this.titleTopY[i] && positionY < this.titleTopY[i + 1]))) {\n          this.currentIndex = i\n          console.log(this.currentIndex)\n          this.$refs.nav.currentIndex = this.currentIndex\n        }\n      }\n      //抽取混入\n      this.listenShowBackTop(position)\n    },\n    //加入购物车\n    addToCart(){\n      //获取数据\n     const product = {}\n     product.image = this.topimages[0];\n     product.title = this.goods.title;\n     product.desc = this.goods.desc;\n     product.price = this.goods.oldPrice;\n     product.iid = this.iid;\n     //添加到购物车\n   // this.$store.commit('addCart',product)\n      this.$store.dispatch('addCart',product).then((res)=>{\n      this.show = true;\n      this.message = res;\n      setTimeout(()=>{\n        this.show = false\n        this.message=''\n      },1500)\n\n        // console.log(this.$toast)\n        // this.$toast.Show()\n      })\n\n    }\n  }\n\n}\n</script>\n\n<style scoped>\n#detail {\n  height: 100vh;\n  position: relative;\n  z-index: 1;\n  background-color: #fff;\n}\n\n.content {\n  position: absolute;\n  top: 44px;\n  bottom: 60px;\n  left: 0;\n  right: 0;\n  overflow: hidden;\n}\n\n.detail-nav {\n  position: fixed;\n  z-index: 9;\n  background-color: #fff;\n}\n</style>\n"]}]}